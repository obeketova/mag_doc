----MAG Test List----
Run Cases:
1. with bench1 run restart
*Start with par.bnch1:
 init=0404, (initial temp perturbation l=4, m=4  is imposed)
 treset=.true.,
 samp=0.1000,
 nstep=200,
 nprnt=08,
 nstor=04,
*rename the last output file d3.bench1 to "initfile", and modify par.bnch1 as following
 infile="initfile",
 init=0,
 treset=.true.,
 samp=0.1000,
 nstep=800,
 nprnt=08,
 nstor=08,
*run restart a few times, each time rename d7.bench1 to "initfile"
compare output with published benchmark 
 
 
2. produce unformated data for magsym.pro data process
   set ngfom=2 for unformated file
   g file size is half of the formatted one
   
3. dtmax, the maximum(initial) time step
    set dtmax= 0.25e-4 = 0.000025 in bench1
    dtmax < 0.25*Ekman (Ekman=1.0e-3)
    dtmax=0.25e-3
     
4. courfac determines dt limit, set to 3, 4 in bench1 with dtmax=1.5e-4
   larger courfac gives smaller dt
   reduce courfac would reduce run time, program running more efficent. It is a balanced act
   
5. radratio ri/ro 	=0.35 (bench1, bench0)
   set to:        	
			=0.8 MAG runs ok
			=0.99 MAG runs ok
			=0.1 MAG runs only executed 23 statement
			=0.05 MAG runs only executed 23 statement
			=0.005 MAG runs only executed 23 statement
			=0.  MAG hangs, dose not kick out the program. It has to be terminated manually

   		
6. Rayleigh number: Ra = 1.0e5=100000 in bench1   	
   set to                
			3.0e4 
			6.0e4
			3.0e5
			6.0e5	

   	
7. Prandtl number Pr stable, Pr=1.0 in bench1. (dynamo models)
   set Pr = 0.1 (Iron Core)

8. Magnetic Prandtl number Prmag = 0.5 -10, Prmag=5.0 in bench1
   set Prmag = 10 for test
   MAG runs ok
   
9. bpeak is the peak value of magnetic field imposed by boundary condition at ICB.
   bpeak = -5 in bench1, with imagcon =0, initial magnetic field is poloidal dipole
   set bpeak > 0 for test, imagcon=0, initial magnetic field is toroidal
   set:               
		bpeak = 5.0 
		bpeak = 0.5
    
10. boundary conditions:
 						ktops = 1 fixed temp at CMB
 						ktops = 2 fixed radial heatflow @CMB
 						kbots = 1 fixed temp at ICB
 						kbots = 2 fixed radial heatflow at ICB
 						ktopv = 1 velocity condition is free at CMB
 						kbotv = 2 velocity condition is rigid at CMB
 						ktopb = 1 for insulating mantel
 						ktotb = 2 for ideally conduction inner core
 						kbotb = 1 for insulating inner core (fixed)
 						imagcon < 0 
 	      bnch1 	
 	ktops	1		2	1	2
 	kbots	1		2	2	1
 	ktopv	2					1	1	2
 	kbotv	2					2	1	1
 	ktopb	1								2	
 	kbotb	1								1
    				x 	y	y	y	y	y	y		  
	
	When ktops and kbots both set to 2, i.e. fixed radial heatflow at both CMB and ICB, MAG crashes.
	
	
11. Movie file generation:

	imovopt:	
			0100 -> mm.
			0010 -> ma.
			0001 -> me.
			1111 -> me. ma. mm. cc. 
			1001 -> cc. me.
			1000 -> cc.
			5000 -> cc.
 	
 	cc file was created with imovopt=1###, but all cc files were empty
 	in bench1: 
 			iframes = 0
 			tmovstart = 0
 			tmovsteps = 0
    	did not test above three parameters.

	In amhd.f, moved call cmbcoeff(kcv) out of if statement like following:

      if((time/tscale.ge.tmovnext).and.(imovct.le.iframes)) then
c        if(kc.eq.nn) then
c         if(imovopt.ge.1000) then
c          kcv=imovopt/1000
c          call cmbcoeff(kcv)
c         endif
c         imovct=imovct+1
c         tmovnext=tmovnext+tmovstep
c        endif
        kcv=imovopt/1000
        call cmbcoeff(kcv)
        kvp=mod(imovopt,1000)/100
        if(mod(imovopt,10).ge.1) call moveout(kc)
        if(mod(imovopt,100).ge.10) call movaout(kc)
        if(mod(imovopt,1000).ge.100) call movmout(kc,kvp)
      endif
	
	cc file was empty. Need to exam cmbcoeff.f
 	
12. Hyperdiffusivities:  
 	bench1:				
		difamp: = 2.	(amplitude of hyperdiffusivities)
		ldif:	= 1	(hyperdiffusivites applied for harmonic degrees l>= ldif)
		ldifexp:= -1	(exponet for increase of hyperdiffusities with l)
	test:
		difamp: =4 and Ra=10e6 (increases the convergence)
		ldifexp:=-2 (damping fact)
 
13. re-scale parameters:
				bench1			
			amps	1
			ampw	1
			ampz	1
			ampb	1	2	-1
			ampj	1	2	-1
			
          
To Do: 
 IDL:
 
 1. magsym.pro to read in unformated data  
 2. Add color bar in display
 3. add error handling in magsym while read in data file
 
 MAG:
 
 1. add more field in output files l. ls. 
